## これは何？
- 回答ZKP
- 答えのhashが合っているかを答えを明かさずに回答
- フロントランニング対策で、msg.senderをinputにして、private inputでaddressを入れておいて、そのaddressがmsg.senderと一致しているかを検証する

## 動かし方
1. `bash compile.bash`
2. `verifier.sol` の一部を書き換える
```solidity
    function addressToUintArray(address addr) public pure returns (uint32[8] memory) {
        uint32[8] memory result;

        // Convert address to uint
        uint addrUint = uint(uint160(addr));

        // Split the uint into chunks of 32 bits
        for (uint i = 0; i < 8; i++) {
            result[7 - i] = uint32(addrUint & 0xFFFFFFFF);
            addrUint >>= 32;
        }

        return result;
    }
    function verifyTx(
            Proof memory proof, uint[8] memory expectedHash
        ) public view returns (bool r) {
        uint[] memory inputValues = new uint[](17);
        
        // 
        for(uint i = 0; i < 8; i++){
            inputValues[i] = expectedHash[i];
        }

        // フロントランニング対策
        uint32[8] memory _addresses = addressToUintArray(msg.sender);
        for(uint i = 0; i < 8; i++){
            inputValues[i + 8] = _addresses[i];
        }

        // outputがtrueになることを検証
        inputValues[16] = 1;

        if (verify(inputValues, proof) == 0) {
            return true;
        } else {
            return false;
        }
    }
```
3. remixとかでデプロイする
4. zokrates print-proofで出てきたproofをコピーして、適当なエディタで開く貼り付ける
  - 元データーはこんな感じのはず
  ```json
  [["0x0220948c5f9e3f9e18b96a45b413facd1a065520cc7bf754e8f8482fe9cfd4f0","0x2996084be4f1608e4907d3f5612013a4b56d099d41191c96f74fba10377750f1"], [["0x18cd69f484163de7b6591cf6d2f3308ff290ea666402c2c9a1880fe9e608323b","0x05bcd398592d65aebdc12f3a46c638a6790fef64af9517dfa76507f478acb355"],["0x2f05f6b7ed0bbe80041a3b933fabccf2edb20df868479f388f026df35e219124","0x1140f94ab40f1131763b256c0ddf0bddd06cb4d6cb1ad81a082a7ffbe83b01a7"]], ["0x00910b3dcb1d75bb63839c1af68abf406caf539031a73d2c00fcb52eeff5b672","0x2efa5d35906e75d637cce192f5a1a637c315815d887f737eb753228316517156"]],["0x0000000000000000000000000000000000000000000000000000000008c4242b","0x000000000000000000000000000000000000000000000000000000005f585628","0x00000000000000000000000000000000000000000000000000000000bb8cef8e","0x00000000000000000000000000000000000000000000000000000000de40e989","0x000000000000000000000000000000000000000000000000000000005b8719eb","0x000000000000000000000000000000000000000000000000000000008070aee2","0x00000000000000000000000000000000000000000000000000000000d9661358","0x000000000000000000000000000000000000000000000000000000003ee3904a","0x0000000000000000000000000000000000000000000000000000000000000000","0x0000000000000000000000000000000000000000000000000000000000000000","0x0000000000000000000000000000000000000000000000000000000000000000","0x000000000000000000000000000000000000000000000000000000005b38da6a","0x00000000000000000000000000000000000000000000000000000000701c5685","0x0000000000000000000000000000000000000000000000000000000045dcfcb0","0x000000000000000000000000000000000000000000000000000000003fcb875f","0x0000000000000000000000000000000000000000000000000000000056beddc4","0x0000000000000000000000000000000000000000000000000000000000000001"]
  ```
- 全部のパラメーターはコントラクトの外部から渡さないので消す
`0x00.00` が3つ続くところから後ろまではいらない
```
  [["0x0220948c5f9e3f9e18b96a45b413facd1a065520cc7bf754e8f8482fe9cfd4f0","0x2996084be4f1608e4907d3f5612013a4b56d099d41191c96f74fba10377750f1"], [["0x18cd69f484163de7b6591cf6d2f3308ff290ea666402c2c9a1880fe9e608323b","0x05bcd398592d65aebdc12f3a46c638a6790fef64af9517dfa76507f478acb355"],["0x2f05f6b7ed0bbe80041a3b933fabccf2edb20df868479f388f026df35e219124","0x1140f94ab40f1131763b256c0ddf0bddd06cb4d6cb1ad81a082a7ffbe83b01a7"]], ["0x00910b3dcb1d75bb63839c1af68abf406caf539031a73d2c00fcb52eeff5b672","0x2efa5d35906e75d637cce192f5a1a637c315815d887f737eb753228316517156"]],["0x0000000000000000000000000000000000000000000000000000000008c4242b","0x000000000000000000000000000000000000000000000000000000005f585628","0x00000000000000000000000000000000000000000000000000000000bb8cef8e","0x00000000000000000000000000000000000000000000000000000000de40e989","0x000000000000000000000000000000000000000000000000000000005b8719eb","0x000000000000000000000000000000000000000000000000000000008070aee2","0x00000000000000000000000000000000000000000000000000000000d9661358","0x000000000000000000000000000000000000000000000000000000003ee3904a"]
  ```

5. デフォルトのテストアカウントの 0x5B38Da6a701c568545dCfcB03FcB875f56beddC4であればそのままで良い
6. 違うアドレスの場合はaddressToUintArrayでアドレスをintに変換する
7. 4.のproofを貼り付けてverifyTxを実行する


## zokratesのargsについて
```bash
$ zokrates compute-witness -a 115 116 111 99 107 147072043 1599624744 3146575758 3728796041 1535580651 2154868450 3647345496 1055101002 0 0 0 1530452586 1880905349 1172110512 1070303071 1455349188 0 0 0 1530452586 1880905349 1172110512 1070303071 1455349188b
```
witnessが計算できるってことは回路がうまく動いて正常に動作してるってことだと思う

`def main(private u8[5] word, u32[8] expectedHash,private  u32[8] addressUint, u32[8] pubAddressUint) -> bool`

この引数を渡すには上記のような数字で渡す

- word: 115 116 111 99 107
- expectedHash: 147072043 1599624744 3146575758 3728796041 1535580651 2154868450 3647345496 1055101002
- addressUint: 0 0 0 1530452586 1880905349 1172110512 1070303071 1455349188
- pubAddressUint: 0 0 0 1530452586 1880905349 1172110512 1070303071 1455349188b


### wordとexpectedHashの算出方法
```bash
node sha256.js stock
word: 115 116 111 99 107
expectedHash(dec chunked): 147072043 1599624744 3146575758 3728796041 1535580651 2154868450 3647345496 1055101002
```


### addressUintとpubAddressUintの算出方法
- deployしたコントラクトに生えてる `addressToUintArray` を使う
